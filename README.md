# bbi-js

[![NPM version](https://img.shields.io/npm/v/@gmod/bbi.svg?style=flat-square)](https://npmjs.org/package/@gmod/bbi)
[![Build Status](https://img.shields.io/travis/GMOD/bbi-js/master.svg?style=flat-square)](https://travis-ci.org/GMOD/bbi-js) [![Coverage Status](https://img.shields.io/codecov/c/github/GMOD/bbi-js/master.svg?style=flat-square)](https://codecov.io/gh/GMOD/bbi-js/branch/master)

A parser for bigwig and bigbed file formats

## Examples

### BigWig example

```js
    const {BigWig} = require('@gmod/bbi');
    const ti = new BigWig({
      path: 'volvox.bw'
      // url: 'http://localhost/volvox.bw'
      // filehandle: new RemoteFile('http://localhost/volvox.bw') from generic-filehandle
    });
    (async () => {
      // contains features and information about chromosomes in response
      const header = await ti.getHeader();

      // acquire features, note 0-based query and 0-based features are returned
      const feats = await ti.getFeatures('chr1', 0, 100,);

      // alternatively, use getFeatureStream. featCallback will receives arrays of features
      // const observer = await bigwig.getFeatureStream('chr1', 0, 100)
      // observer.subscribe(featCallback, errorCallback, completedCallback)
    })();
```

### BigBed example

The BigBed line contents are returned as a "rest" field in the output  e.g. 

    {
        uniqueId: 'bb-171', // based on file offset
        start: 0,
        end: 100,
        rest: "ENST00000456328.2\t1000\t..."
    }

The rest line can be parsed by the @gmod/bed module, which is not by integrated with this module, but can be combined with it as follows

```js
    import {BigBed} from '@gmod/bbi'
    import BED from '@gmod/bed'

    const ti = new BigBed({
      filehandle: new LocalFile(require.resolve('./data/hg18.bb')),
    })
    const {autoSql} = await ti.getHeader()
    const feats = await ti.getFeatures('chr7', 0, 100000)
    const parser = new BED({autoSql})
    const lines = feats.map(f => {
        const { start, end, rest, uniqueId } = f
        // we reconstitute this as a line for @gmod/bed with a template string
        return parser.parseLine(`chr7\t${f.start}\t${f.end}\t${f.rest}, { uniqueId: f.uniqueId })\
    })
```

Example feature after parsing with @gmod/bed:

```js
      { uniqueId: 'bb-0',
        chrom: 'chr7',
        chromStart: 54028,
        chromEnd: 73584,
        name: 'uc003sii.2',
        score: 0,
        strand: -1,
        thickStart: 54028,
        thickEnd: 54028,
        reserved: '255,0,0',
        spID: 'AL137655' }
```

## Documentation

### BBI

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [getFeatureStream](#getfeaturestream)
    -   [Parameters](#parameters)

#### getFeatureStream

Gets features from a BigWig file

##### Parameters

-   `refName` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The chromosome name
-   `start` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The start of a region
-   `end` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The end of a region
-   `opts` **{basesPerSpan: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?, scale: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?, signal: AbortSignal?}** An object containing basesPerSpan (e.g. pixels per basepair) or scale used to infer the zoomLevel to use (optional, default `{scale:1}`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;Observable&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Feature>>>** 

### BigWig

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

-   [getView](#getview)
    -   [Parameters](#parameters)

#### getView

Retrieves a BlockView of a specific zoomLevel

##### Parameters

-   `scale` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `abortSignal` **AbortSignal?** 
-   `refName`  The chromosome name
-   `start`  The start of a region
-   `end`  The end of a region
-   `opts`  An object containing basesPerSpan (e.g. pixels per basepair) or scale used to infer the zoomLevel to use

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;BlockView>** 

### BigBed

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

### Understanding scale and reductionLevel

Here is what the reductionLevel structure looks like in a file. The zoomLevel that is chosen is the first reductionLevel&lt;2\*opts.basesPerScale (or reductionLevel&lt;2/opts.scale) when scanning backwards through this list

      [ { reductionLevel: 40, ... },
        { reductionLevel: 160, ... },
        { reductionLevel: 640, ... },
        { reductionLevel: 2560, ... },
        { reductionLevel: 10240, ... },
        { reductionLevel: 40960, ... },
        { reductionLevel: 163840, ... } ]

## Academic Use

This package was written with funding from the [NHGRI](http://genome.gov) as part of the [JBrowse](http://jbrowse.org) project. If you use it in an academic project that you publish, please cite the most recent JBrowse paper, which will be linked from [jbrowse.org](http://jbrowse.org).

## License

MIT Â© [Colin Diesh](https://github.com/cmdcolin)
